<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NGM HUB — Expenses Engine</title>

    <!-- mismas fuentes que login/dashboard -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link 
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" 
      rel="stylesheet"
    >

    <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img 
                    src="assets/img/logo.png" 
                    alt="NGM HUB Logo"
                    class="sidebar-logo-img"
                />
            </div>
            <div class="sidebar-title-block">
                <p class="sidebar-title">NGM HUB</p>
                <p class="sidebar-subtitle">Expenses Engine</p>
            </div>

            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">Overview</a>
                <a href="expenses.html" class="nav-item nav-item-active">Expenses</a>
                <a href="projects.html" class="nav-item">Projects</a>
                <a href="#" class="nav-item">Finance</a>
                <a href="#" class="nav-item">Estimator</a>
            </nav>
        </aside>

        <!-- Main -->
        <div class="main-area">
            <header class="topbar">
                <div class="topbar-left">
                    <h1 class="topbar-title">Expenses Engine</h1>
                    <p class="topbar-subtitle">
                        Safely capture and classify expenses without breaking any spreadsheet.
                    </p>
                </div>
                <div class="topbar-right">
                    <span class="user-pill">Master User</span>
                </div>
            </header>

            <main class="main-content">
                
                <!-- Formulario de nuevo gasto -->
                <section>
                    <h2 class="section-title">New Expense</h2>
                    <div class="panel">
                        <form id="expenseForm" class="form-grid">
                            
                            <div class="field">
                                <label class="field-label" for="exp-date">Date</label>
                                <input 
                                    id="exp-date"
                                    type="date"
                                    class="input"
                                    required
                                >
                            </div>

                            <div class="field">
                                <label class="field-label" for="exp-project">Project</label>
                                <select id="exp-project" class="input" required>
                                    <option value="">Select a project</option>
                                </select>
                            </div>

                            <div class="field">
                                <label class="field-label" for="exp-amount">Amount</label>
                                <input 
                                    id="exp-amount"
                                    type="number"
                                    step="0.01"
                                    min="0"
                                    placeholder="0.00"
                                    class="input"
                                    required
                                >
                            </div>

                            <div class="field field-full">
                                <label class="field-label" for="exp-desc">Description</label>
                                <input 
                                    id="exp-desc"
                                    type="text"
                                    placeholder="Vendor, concept, payment method, etc."
                                    class="input"
                                    required
                                >
                            </div>

                            <div class="form-footer form-footer-right">
                                <button type="submit" class="btn-primary">
                                    Save Expense
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Entradas recientes (mock por ahora) -->
                <section class="data-section">
                    <h2 class="section-title">Recent Entries (mock)</h2>
                    <div class="panel">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Project</th>
                                    <th>Amount</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <tr>
                                    <td>2025-12-01</td>
                                    <td>Del Rio ADU</td>
                                    <td>$1,250.00</td>
                                    <td>Framing materials — paid with Amex</td>
                                </tr>
                                <tr>
                                    <td>2025-12-02</td>
                                    <td>San Diego Duplex</td>
                                    <td>$420.50</td>
                                    <td>Site visit + permits fee</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            
            </main>
        </div>
    </div>

    <!-- Mock Projects File -->
    <script src="assets/js/mock-projects.js"></script>

    <script>
        // --- Poblar Dropdown de Proyectos ---
        const projectSelect = document.getElementById('exp-project');

        if (typeof mockProjects !== 'undefined' && Array.isArray(mockProjects)) {
            mockProjects.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.name;
                projectSelect.appendChild(opt);
            });
        }

        // --- Lógica del formulario ---
        const expenseForm = document.getElementById('expenseForm');
        const tbody = document.getElementById('expensesTableBody');

        expenseForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const date = document.getElementById('exp-date').value;
            const projectId = document.getElementById('exp-project').value;
            const amount = document.getElementById('exp-amount').value;
            const desc = document.getElementById('exp-desc').value.trim();

            if (!date || !projectId || !amount || !desc) return;

            const projectName = mockProjects.find(p => p.id === projectId)?.name || projectId;

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${date}</td>
                <td>${projectName}</td>
                <td>$${Number(amount).toFixed(2)}</td>
                <td>${desc}</td>
            `;
            tbody.prepend(tr);

            console.log("New expense (mock):", { date, projectId, projectName, amount, desc });

            expenseForm.reset();
        });
    </script>

</body>
</html>
