<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NGM HUB — Expenses Engine</title>

    <!-- mismas fuentes que login/dashboard -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link 
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" 
      rel="stylesheet"
    >

    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/expenses_styles.css" />

    <!-- Global env/server/user pills -->
    <script src="assets/js/config.js" defer></script>
    <script src="assets/js/pills.js" defer></script>

</head>
<body class="page-expenses">
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img 
                    src="assets/img/logo.png" 
                    alt="NGM HUB Logo"
                    class="sidebar-logo-img"
                />
            </div>
            <div class="sidebar-title-block">
                <p class="sidebar-title">NGM HUB</p>
                <p class="sidebar-subtitle">Expenses Engine</p>
            </div>

            <!-- Sidebar nav (fallback static for now; later sidebar.js can override by id) -->
            <nav class="sidebar-nav" id="sidebar-nav">
                <a href="dashboard.html" class="nav-item">Overview</a>
                <a href="expenses.html" class="nav-item nav-item-active">Expenses</a>
                <a href="projects.html" class="nav-item">Projects</a>
                <a href="pipeline.html" class="nav-item">Pipeline</a>
                <a href="team.html" class="nav-item">Team</a>
                <a href="users.html" class="nav-item">Users</a>
                <a href="#" class="nav-item">Finance</a>
                <a href="#" class="nav-item">Estimator</a>
            </nav>
        </aside>

        <!-- Main area -->
        <div class="main-area">

            <!-- Topbar (system standard) -->
            <header class="ngm-topbar">
                <div class="ngm-bar-left">
                    <div class="ngm-brand">
                        <div class="ngm-brand-icon-small"><span>⚡</span></div>
                        <div class="ngm-brand-text">
                            <span class="ngm-brand-org">Next Generation Management</span>
                            <span class="ngm-brand-context">NGM Hub · Expenses Engine</span>
                        </div>
                    </div>
                </div>

                <div class="ngm-topbar-right">
                    <div class="ngm-meta">
                        <span id="env-pill" class="ngm-meta-pill ngm-meta-env">Environment · —</span>
                        <span id="server-pill" class="ngm-meta-pill ngm-meta-status ngm-meta-status-live">Server · —</span>
                    </div>

                    <form class="ngm-search" role="search" onsubmit="return false;">
                        <span class="ngm-global-search-icon">⌕</span>
                        <input
                            id="expenses-search-input"
                            type="search"
                            class="ngm-search-input"
                            placeholder="Search expenses…"
                            aria-label="Search expenses"
                        />
                    </form>

                    <span id="user-pill" class="user-pill">User · —</span>
                </div>
            </header>

            <main class="main-content">
                <div class="workspace">

                    <!-- Formulario de nuevo gasto -->
                    <section>
                        <h2 class="section-title">New Expense</h2>

                        <div class="ngm-card">
                            <form id="expenseForm" class="form-grid">
                                
                                <div class="field">
                                    <label class="field-label" for="exp-date">Date</label>
                                    <input 
                                        id="exp-date"
                                        type="date"
                                        class="input"
                                        required
                                    >
                                </div>

                                <div class="field">
                                    <label class="field-label" for="exp-project">Project</label>
                                    <select id="exp-project" class="input" required>
                                        <option value="">Select a project</option>
                                    </select>
                                </div>

                                <div class="field">
                                    <label class="field-label" for="exp-amount">Amount</label>
                                    <input 
                                        id="exp-amount"
                                        type="number"
                                        step="0.01"
                                        min="0"
                                        placeholder="0.00"
                                        class="input"
                                        required
                                    >
                                </div>

                                <div class="field field-full">
                                    <label class="field-label" for="exp-desc">Description</label>
                                    <input 
                                        id="exp-desc"
                                        type="text"
                                        placeholder="Vendor, concept, payment method, etc."
                                        class="input"
                                        required
                                    >
                                </div>

                                <div class="form-footer form-footer-right">
                                    <button type="submit" class="btn-primary">
                                        Save Expense
                                    </button>
                                </div>
                            </form>
                        </div>
                    </section>

                    <!-- Entradas recientes (mock por ahora) -->
                    <section class="data-section">
                        <h2 class="section-title">Recent Entries (mock)</h2>

                        <div class="ngm-sheet">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Project</th>
                                        <th>Amount</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody id="expensesTableBody">
                                    <tr>
                                        <td>2025-12-01</td>
                                        <td>Del Rio ADU</td>
                                        <td>$1,250.00</td>
                                        <td>Framing materials — paid with Amex</td>
                                    </tr>
                                    <tr>
                                        <td>2025-12-02</td>
                                        <td>San Diego Duplex</td>
                                        <td>$420.50</td>
                                        <td>Site visit + permits fee</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                </div>
            </main>
        </div>
    </div>

    <!-- Mock Projects File -->
    <script src="assets/js/mock-projects.js"></script>

    <script>
        // --- Poblar Dropdown de Proyectos ---
        const projectSelect = document.getElementById('exp-project');

        if (typeof mockProjects !== 'undefined' && Array.isArray(mockProjects)) {
            mockProjects.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.name;
                projectSelect.appendChild(opt);
            });
        }

        // --- Handler de "Save Expense" (mock) ---
        const expenseForm = document.getElementById('expenseForm');
        const tbody = document.getElementById('expensesTableBody');

        expenseForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const date = document.getElementById('exp-date').value;
            const projectId = document.getElementById('exp-project').value;
            const amount = document.getElementById('exp-amount').value;
            const desc = document.getElementById('exp-desc').value.trim();

            if (!date || !projectId || !amount || !desc) return;

            const projectName = mockProjects.find(p => p.id === projectId)?.name || projectId;

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${date}</td>
                <td>${projectName}</td>
                <td>$${Number(amount).toFixed(2)}</td>
                <td>${desc}</td>
            `;
            tbody.prepend(tr);

            expenseForm.reset();
        });
    </script>

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            if (window.initTopbarPills) window.initTopbarPills();
            if (window.initSidebar) window.initSidebar(); // futuro sidebar.js
        });
    </script>

</body>
</html>
